{{ block title }}Questionnaire{{ endblock }} {{ block content }}

<style>
  /* Custom Styles for Professional Likert Table */
  .question-table {
    width: 100%;
    margin-bottom: 2rem;
  }
  .question-table td {
    padding: 15px 10px;
    vertical-align: middle;
    border-bottom: 1px solid #dee2e6;
  }
  .question-text {
    font-size: 1.05rem;
    font-weight: 500;
  }

  /* Likert Scale Styles */
  .likert-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px; /* Spacing between options */
    white-space: nowrap;
  }

  .likert-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    margin: 0; /* Reset margins */
  }

  /* Custom Radio Circle */
  .likert-option input[type="radio"] {
    margin-bottom: 5px;
    transform: scale(1.3); /* Make radio buttons slightly larger */
    cursor: pointer;
  }

  .likert-number {
    font-size: 0.85rem;
    color: #6c757d;
  }

  /* Selected state */
  .likert-option input[type="radio"]:checked + .likert-number {
    color: #0d6efd; /* Primary color */
    font-weight: bold;
  }

  /* Endpoint Labels */
  .scale-label {
    font-size: 0.85rem;
    font-weight: 600;
    color: #495057;
    margin: 0 10px;
  }
  .scale-label-left { text-align: right; }
  .scale-label-right { text-align: left; }

</style>

<div class="card">
  <div class="card-body">
    <p>
      Thank you for completing the decision-making portion of the experiment.
      Next, please answer the following questions regarding your experience and
      background. Your answers are anonymous and will be used for research
      purposes only.
    </p>

    <h4 class="mt-4 mb-3 text-primary">Part 1: Decision Reflection</h4>
    <p class="mb-4 text-muted">
      Please indicate how much you agree or disagree with the following statements.
    </p>

    <table class="question-table">
      <tbody>
        {{ for f in q_fields }}
        <tr>
          <td style="width: 40%;">
            <div class="question-text">{{ f.label }}</div>
          </td>
          <td style="width: 60%;">
            <div class="likert-container">
              <!-- Left Label -->
              <span class="scale-label scale-label-left">Strongly<br>Disagree</span>

              <!-- Radio Buttons 1-7 -->
              <label class="likert-option">
                <input type="radio" name="{{ f.name }}" value="1" required>
                <span class="likert-number">1</span>
              </label>
              <label class="likert-option">
                <input type="radio" name="{{ f.name }}" value="2" required>
                <span class="likert-number">2</span>
              </label>
              <label class="likert-option">
                <input type="radio" name="{{ f.name }}" value="3" required>
                <span class="likert-number">3</span>
              </label>
              <label class="likert-option">
                <input type="radio" name="{{ f.name }}" value="4" required>
                <span class="likert-number">4</span>
              </label>
              <label class="likert-option">
                <input type="radio" name="{{ f.name }}" value="5" required>
                <span class="likert-number">5</span>
              </label>
              <label class="likert-option">
                <input type="radio" name="{{ f.name }}" value="6" required>
                <span class="likert-number">6</span>
              </label>
              <label class="likert-option">
                <input type="radio" name="{{ f.name }}" value="7" required>
                <span class="likert-number">7</span>
              </label>

              <!-- Right Label -->
              <span class="scale-label scale-label-right">Strongly<br>Agree</span>
            </div>

            <!-- Hidden error message container if needed by oTree (though 'required' handles most) -->
          </td>
        </tr>
        {{ endfor }}
      </tbody>
    </table>

    <h4 class="mt-5 mb-3 text-primary">Part 2: Background Information</h4>

    {{ formfield 'dem_sex' }}
    {{ formfield 'dem_age' }}

    <div class="mb-3 _formfield">
        <label class="col-form-label fw-bold">3. What is your current employment status? (Select all that apply)</label>
        <div class="controls ms-3">
            <div class="form-check">
                <input class="form-check-input employment-checkbox" type="checkbox" value="Student" id="emp_student">
                <label class="form-check-label" for="emp_student">Student</label>
            </div>
            <div class="form-check">
                <input class="form-check-input employment-checkbox" type="checkbox" value="Working" id="emp_working">
                <label class="form-check-label" for="emp_working">Working</label>
            </div>
            <div class="form-check">
                <input class="form-check-input employment-checkbox" type="checkbox" value="Retired" id="emp_retired">
                <label class="form-check-label" for="emp_retired">Retired</label>
            </div>
            <div class="form-check">
                <input class="form-check-input employment-checkbox" type="checkbox" value="Unemployed" id="emp_unemployed">
                <label class="form-check-label" for="emp_unemployed">Unemployed</label>
            </div>
            <div class="form-check">
                <input class="form-check-input employment-checkbox" type="checkbox" value="Other" id="emp_other">
                <label class="form-check-label" for="emp_other">Other</label>
            </div>
            <!-- Hidden Input to store the list data -->
            <input type="hidden" name="dem_employment" id="id_dem_employment">
        </div>
    </div>

    {{ formfield 'dem_income' }}
    {{ formfield 'dem_familiar' }}

    <div id="strategy-name-wrapper" style="display: none">
      {{ formfield 'dem_strategy_name' }}
    </div>
  </div>
</div>

<div class="mt-4 text-center">
    <button class="btn btn-primary btn-lg px-5">Submit Questionnaire</button>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Familiarity field logic
    const familiarField = document.querySelectorAll(
      'input[name="dem_familiar"]'
    );
    const strategyWrapper = document.getElementById("strategy-name-wrapper");

    function toggleStrategyField() {
      // Logic for radio buttons (oTree renders them with specific IDs/names)
      // Usually named "dem_familiar"
      const yesRadio = document.querySelector('input[name="dem_familiar"][value="Yes"]');

      if (yesRadio && yesRadio.checked) {
        strategyWrapper.style.display = "block";
      } else {
        strategyWrapper.style.display = "none";
      }
    }

    familiarField.forEach(function (radio) {
      radio.addEventListener("change", toggleStrategyField);
    });

    // Employment checkboxes logic
    const employmentCheckboxes = document.querySelectorAll('.employment-checkbox');
    const employmentHiddenInput = document.getElementById('id_dem_employment');

    function updateEmploymentInput() {
        const selected = [];
        employmentCheckboxes.forEach(function(cb) {
            if (cb.checked) {
                selected.push(cb.value);
            }
        });
        employmentHiddenInput.value = JSON.stringify(selected);
    }

    employmentCheckboxes.forEach(function(cb) {
        cb.addEventListener('change', updateEmploymentInput);
    });
  });
</script>

{{ endblock }}
