{{ block title }}Decision - Round {{ subsession.round_number }}{{ endblock }} {{
block content }}

<div class="card">
  <div class="card-body">
    <h3 class="card-title text-primary">
      Your Role: BUYER (Round {{ subsession.round_number }} of {{ C.NUM_ROUNDS
      }})
    </h3>

    <div class="alert alert-info mt-3">
      <p>
        You have been randomly assigned the role of the
        <strong>BUYER</strong>. The other person is in the role of the
        <strong>SELLER</strong>.
      </p>
    </div>

    <div class="card mt-3">
      <div class="card-body">
        <h5 class="card-title">Product Information</h5>
        <p>
          Product A is a hypothetical product that gives you a utility value of
          <strong>{{ utility }} tokens</strong>. The suggested price for this
          product, as set by the seller, is
          <strong>{{ suggested_price }} tokens</strong>.
        </p>
      </div>
    </div>

    <div class="row mt-3">
      <div class="col-md-6">
        <div class="card bg-light">
          <div class="card-body">
            <h5 class="card-title">Endowment</h5>
            <p class="display-4 text-primary">{{ endowment }} tokens</p>
            <small class="text-muted">Your starting amount</small>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card bg-light">
          <div class="card-body">
            <h5 class="card-title">Product Utility</h5>
            <p class="display-4 text-success">{{ utility }} tokens</p>
            <small class="text-muted">Value you get from purchasing Product A</small>
          </div>
        </div>
      </div>
    </div>

    <div class="card mt-3">
      <div class="card-body">
        <h5 class="card-title">Payoff Calculation</h5>
        <p>If you decide to purchase the product, you will receive it regardless of the price you pay:</p>
        <ul>
          <li>
            The SELLER receives the amount you choose to pay, minus the production cost.
          </li>
          <li>
            You receive any remaining endowment plus the utility value you derive from Product A.
          </li>
        </ul>
        <p>If you decide NOT to purchase the product:</p>
        <ul>
          <li>The SELLER receives 0.</li>
          <li>You keep the endowment.</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<div class="alert alert-info mt-3">
  <div class="card-body">
    <h4>Make Your Decision</h4>

    {{ formfield 'buyer_decision' }}

    <div id="price-field" class="mt-3">{{ formfield 'price_paid' }}</div>
  </div>
</div>

<div class="mt-4">{{ next_button }}</div>

<script>
  // Show/hide price field based on buyer decision
  document.addEventListener("DOMContentLoaded", function () {
    const buyerDecision = document.querySelector(
      'input[name="buyer_decision"]'
    );
    const priceField = document.getElementById("price-field");

    function togglePriceField() {
      const yesChecked = document.querySelector(
        'input[name="buyer_decision"][value="True"]'
      ).checked;
      if (yesChecked) {
        priceField.style.display = "block";
      } else {
        priceField.style.display = "none";
      }
    }

    // Initial state
    togglePriceField();

    // Listen for changes
    document
      .querySelectorAll('input[name="buyer_decision"]')
      .forEach(function (radio) {
        radio.addEventListener("change", togglePriceField);
      });
  });
</script>

{{ endblock }}
